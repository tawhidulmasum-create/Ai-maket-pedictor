<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Market Predictor</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-gray-100 to-gray-300 flex items-center justify-center min-h-screen">

<div class="bg-white p-5 rounded-2xl shadow-xl w-full max-w-sm">
  <h1 class="text-xl font-bold text-center mb-1">AI Market Predictor</h1>
  <p class="text-xs text-center text-gray-500 mb-4">On-device Vision Analysis</p>

  <input type="file" id="img" accept="image/*" class="hidden">

  <button onclick="document.getElementById('img').click()"
    class="w-full py-2 mb-3 rounded-xl bg-gray-200 font-medium">
    Select Chart Image
  </button>

  <img id="preview" class="rounded-xl mb-3 hidden border"/>

  <button onclick="predict()"
    class="w-full py-2 rounded-xl bg-black text-white font-medium">
    Analyze Market
  </button>

  <div id="loading" class="text-center text-sm mt-3 hidden">Analyzing chart…</div>
  <div id="result" class="mt-4 text-center"></div>
</div>

<script>
let imgInput = document.getElementById("img");
let preview = document.getElementById("preview");
let loading = document.getElementById("loading");
let result = document.getElementById("result");
let imageData = null, w = 0, h = 0;

imgInput.onchange = e => {
  const file = e.target.files[0];
  preview.src = URL.createObjectURL(file);
  preview.classList.remove("hidden");
  result.innerHTML = "";

  const img = new Image();
  img.onload = () => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    w = canvas.width = img.width;
    h = canvas.height = img.height;
    ctx.drawImage(img, 0, 0);
    imageData = ctx.getImageData(0, 0, w, h);
  };
  img.src = preview.src;
};

function predict() {
  if (!imageData) return;
  loading.classList.remove("hidden");
  result.innerHTML = "";

  setTimeout(() => {
    let top = 0, bottom = 0;

    for (let y = 0; y < h; y++) {
      for (let x = 0; x < w; x += 8) {
        const i = (y * w + x) * 4;
        const intensity =
          imageData.data[i] +
          imageData.data[i + 1] +
          imageData.data[i + 2];

        if (y < h / 2) top += intensity;
        else bottom += intensity;
      }
    }

    // Deterministic rule:
    // More activity (candles) in upper half → bullish
    const direction = top < bottom ? "UP" : "DOWN";

    // Confidence from difference ratio
    const diff = Math.abs(top - bottom);
    const conf = Math.min(95, 70 + diff / (top + bottom) * 100);

    loading.classList.add("hidden");

    result.innerHTML = `
      <div class="text-lg font-bold ${direction === "UP" ? "text-green-600" : "text-red-600"}">
        Market Direction: ${direction}
      </div>
      <div class="text-sm text-gray-600 mb-2">
        Confidence: ${conf.toFixed(1)}%
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div class="${direction === "UP" ? "bg-green-500" : "bg-red-500"} h-2 rounded-full"
             style="width:${conf}%"></div>
      </div>
    `;
  }, 800);
}
</script>

</body>
</html>
